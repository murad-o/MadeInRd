@page
@using ExporterWeb.Helpers
@model ExporterWeb.Pages.Admin.Industries.IndexModel

@{
    Layout = "_AdminLayout";
}

@section Styles {
    <style>
        .table thead th {
            font-size: 15px !important;
        }
    </style>
}

<div class="container-fluid page__container">

    <div class="page__heading d-flex align-items-center">
        <div class="flex">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb mb-0">
                    <li class="breadcrumb-item"><a asp-page="/Admin/Index">Главная</a></li>
                    <li class="breadcrumb-item active" aria-current="page">Отрасли</li>
                </ol>
            </nav>
            <h1 class="m-0 mt-2">Отрасли</h1>
        </div>
        <div class="d-flex align-items-center">
            <a asp-page="./Create" class="btn btn-success mr-2">Добавить отрасль</a>
        </div>
    </div>

    <div class="card card-form">
        <div class="row no-gutters">
            <div class="col-lg-12 card-form__body card-body">
                
                <div class="table-responsive" data-toggle="lists" data-lists-values='["js-lists-values-employee-name"]'>

                    <table class="table table-striped table-hover">
                        <thead>
                        <tr>
                            <th scope="col" width="30">#</th>
                            <th scope="col">
                                Название
                            </th>
                            <th>
                                @foreach (var lang in Model.SecondaryLanguages)
                                {
                                    <span style="width:70px;" class="mx-1"><img title="@Languages.ToRussian(lang)" class="language-switcher__flag" src="/img/flags/@(lang).svg" alt="Флаг"/></span>
                                }
                            </th>
                            <th style="text-align: right">
                                Действия
                            </th>
                        </tr>
                        </thead>
                        <tbody class="list">
                        @for(var i = 0; i < Model.IndustryTranslations.Count; i++)
                        {
                            <tr>
                                <td>@(i + 1).</td>
                                <td>
                                    <a asp-page="./Edit" asp-route-id="@Model.IndustryTranslations[i].Id">@Model.IndustryTranslations[i].Name</a>
                                </td>
                                <td>
                                
                                    @foreach (var lang in Model.SecondaryLanguages)
                                    {
                                        if (Model.IndustryTranslations[i].Industry!.Translations!.Any(translation => translation.Language == lang))
                                        {
                                            var translationId = Model.IndustryTranslations[i].Industry.Translations.FirstOrDefault(t => t.Language == lang)!.Id;
                                            <span style="width:70px;"><a asp-page="./Edit" asp-route-id="@translationId"><i class="material-icons">create</i></a></span>
                                        }
                                        else
                                        {
                                            <span style="width:70px;"><a asp-page="./CreateTranslation" asp-route-lang="@lang" asp-route-industryId="@Model.IndustryTranslations[i].IndustryId"><i class="material-icons">add_box</i></a></span>
                                        }
                                    }
                                
                                </td>
                                <td style="text-align:right">
                                    <div class="d-flex align-content-center justify-content-end">
                                        <form id="delete-industry" method="post" asp-page-handler="DeleteIndustry" onsubmit="return confirm('Вы действительно хотите удалить @Model.IndustryTranslations[i].Name? При подтверждении удалится вся информация об этой отрасли на всех языках')">
                                            <input type="hidden" name="id" value="@Model.IndustryTranslations[i].IndustryId">
                                            <button type="submit" class="btn btn-rounded btn-danger btn-sm">Удалить</button>
                                        </form>
                                    </div>
                                </td>
                            </tr>
                        }
                        </tbody>
                    </table>
                </div>
                
            </div>
        </div>
    </div>
    
</div>